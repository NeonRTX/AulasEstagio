using System;
using System.Collections.Generic;

class Biblioteca
{
    static Dictionary<int, string> obras;
    static Dictionary<int, string> leitores;
    static int TotalObrasEmEmprestimo;
    static Dictionary<int, int> quantidades;
    static Dictionary<int, string> autores;
    static int idLeitor = 1;
    static int idObra = 1;

    static void Main()
    {
        Console.WriteLine("Iniciando a biblioteca...");

        obras = new Dictionary<int, string>();
        autores = new Dictionary<int, string>();
        quantidades = new Dictionary<int, int>();

        leitores = new Dictionary<int, string>();        

        TotalObrasEmEmprestimo = 0;
        
        
        while (true)
        {
            cadastrarObras();
            break;
        }

        while (true)
        {
            cadastrarLeitores();                                   
            break;
        }

        if (obras.Count == 0 || leitores.Count == 0)
        {
            Console.WriteLine("\nEncerrando a biblioteca por falta de obras ou leitores cadastrados...");

            return;
        }

        while (true)
        {
            
            imprimirMenu();
            string opcao = Console.ReadLine().ToUpper();

            if (opcao == "S")
                break;

            switch (opcao)
            {
                case "1":
                    {
                        emprestarObra();
                        break;

                    }
                case "2":
                    {
                        devolverObra();
                        break;

                    }
                case "3":
                    {
                        listarObras();
                        break;

                    }
                case "4":
                    {
                        listaLeitores();
                        break;
                    }
                case "5":
                    {
                       mostrarEstatisticas();
                        break;

                    }
                default:
                    {
                        Console.WriteLine("\nOpção inválida.");

                        break;
                    }
            }
        }

        Console.WriteLine("\nEncerrando a biblioteca...");
    }

    static void cadastrarObras()
    {
        Console.WriteLine($"\nDigite o título da obra {idObra} (ou 'S' para sair do cadastro de obras):");
        string inputTitulo = Console.ReadLine();

        if (inputTitulo.ToUpper() == "S")
           

        obras.Add(idObra, inputTitulo);

        Console.WriteLine($"Digite o nome do autor da obra '{inputTitulo}':");

        autores.Add(idObra, Console.ReadLine());

        Console.WriteLine($"Digite a quantidade inicial disponível da obra '{inputTitulo}':");
        string inputQuantidade = Console.ReadLine();

        if (!int.TryParse(inputQuantidade, out int quantidade))
            quantidade = 0; // valor padrão caso não seja informada uma quantidade válida

        quantidades.Add(idObra, quantidade);

        idObra++;
    }

    static void cadastrarLeitores() {
        Console.WriteLine($"\nDigite o nome do leitor {idLeitor} (ou 'S' para sair do cadastro de leitores):");
        string inputNome = Console.ReadLine();

        if (inputNome.ToUpper() == "S")
            leitores.Add(idLeitor, inputNome);
        idLeitor++;
    }

    static void imprimirMenu()
    {
        Console.WriteLine("\n1 - Emprestar obra");
        Console.WriteLine("2 - Devolver obra");
        Console.WriteLine("3 - Listar obras");
        Console.WriteLine("4 - Listar leitores");
        Console.WriteLine("5 - Estatísticas");
        Console.WriteLine("S - Sair");
        Console.Write("Selecione a ação: ");
       
    }

    static void listaLeitores()
    {
        Console.WriteLine("\nLista de leitores:");

        var idsLeitores = new List<int>(leitores.Keys);
        for (int i = 0; i < idsLeitores.Count; i++)
        {
            int id = idsLeitores[i];

            Console.WriteLine($"Leitor: ({id}) {leitores[id]}");
        }

    }

    static void listarObras()
    {
        Console.WriteLine("\nLista de obras:");

        var idsObras = new List<int>(obras.Keys);
        for (int i = 0; i < idsObras.Count; i++)
        {
            int id = idsObras[i];

            Console.WriteLine($"Obra: ({id}) {obras[id]} - Autor: {autores[id]} - Quantidade: {quantidades[id]} unidade(s)");
        }

    }

    static void mostrarEstatisticas()
    {
        Console.WriteLine("\nEstatísticas:");

        int totalObrasDisponiveis = 0;

        var idsObras = new List<int>(obras.Keys);
        for (int i = 0; i < idsObras.Count; i++)
        {
            int id = idsObras[i];

            totalObrasDisponiveis += quantidades[id];
        }

        Console.WriteLine($"Total de obras disponíveis: {totalObrasDisponiveis}");
        Console.WriteLine($"Total de obras em empréstimo: {TotalObrasEmEmprestimo}");

    }

    static void devolverObra()
    {
        Console.Write("\nDigite o ID da obra a devolver: ");
        string inputIdObra = Console.ReadLine();

        if (!int.TryParse(inputIdObra, out idObra))
        {
            Console.WriteLine("Obra inválida.");

        }

        if (!obras.ContainsKey(idObra))
        {
            Console.WriteLine("Obra não encontrada.");

        }

        quantidades[idObra]++;

        Console.WriteLine($"Obra '{obras[idObra]}' devolvida.");

        TotalObrasEmEmprestimo--;

    }

    static void emprestarObra()
    {
        Console.Write("\nDigite o ID da obra a emprestar: ");
        string inputIdObra = Console.ReadLine();

        if (!int.TryParse(inputIdObra, out idObra))
        {
            Console.WriteLine("Obra inválida.");

        }

        if (!obras.ContainsKey(idObra))
        {
            Console.WriteLine("Obra não encontrada.");

        }

        if (quantidades[idObra] <= 0)
        {
            Console.WriteLine("Obra indisponível no momento.");

        }

        Console.Write("Digite o ID do leitor: ");
        string inputIdLeitor = Console.ReadLine();

        if (!int.TryParse(inputIdLeitor, out idLeitor))
        {
            Console.WriteLine("Leitor inválido.");

        }

        if (!leitores.ContainsKey(idLeitor)) 
        {
            Console.WriteLine("Leitor não encontrado.");

        }

        quantidades[idObra]--;

        Console.WriteLine($"{leitores[idLeitor]} pegou emprestada a obra '{obras[idObra]}'.");

        TotalObrasEmEmprestimo++;

    }


 
}
